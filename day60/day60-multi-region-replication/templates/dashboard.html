<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 60: Multi-Region Log Replication Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .region-card {
            transition: all 0.3s ease;
        }
        .region-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .log-entry {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .status-healthy { background: linear-gradient(135deg, #10B981, #059669); }
        .status-unhealthy { background: linear-gradient(135deg, #EF4444, #DC2626); }
        .status-error { background: linear-gradient(135deg, #F59E0B, #D97706); }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center">
                        <i class="fas fa-globe text-blue-600 text-2xl mr-3"></i>
                        <h1 class="text-2xl font-bold text-gray-900">Multi-Region Log Replication</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-500">Last updated: {{ lastUpdate }}</span>
                        <button @click="refreshData" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center">
                            <i class="fas fa-sync-alt mr-2"></i>
                            Refresh
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Status Overview -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div v-for="region in regions" :key="region.region" 
                     class="region-card bg-white rounded-lg shadow-md p-6 border-l-4"
                     :style="`border-left-color: ${region.color}`">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">{{ region.region }}</h3>
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 rounded-full"
                                 :class="{
                                     'bg-green-500': region.status === 'healthy',
                                     'bg-red-500': region.status === 'unhealthy',
                                     'bg-yellow-500': region.status === 'error'
                                 }"></div>
                            <span class="text-sm font-medium"
                                  :class="{
                                      'text-green-600': region.status === 'healthy',
                                      'text-red-600': region.status === 'unhealthy',
                                      'text-yellow-600': region.status === 'error'
                                  }">{{ region.status }}</span>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Log Count:</span>
                            <span class="font-semibold">{{ region.log_count }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Last Update:</span>
                            <span class="text-sm">{{ formatTime(region.timestamp) }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add Log Form -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">Add Log Entry</h2>
                <form @submit.prevent="addLog" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Region</label>
                        <select v-model="newLog.region" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="us-east-1">US East (N. Virginia)</option>
                            <option value="us-west-2">US West (Oregon)</option>
                            <option value="eu-west-1">Europe (Ireland)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Level</label>
                        <select v-model="newLog.level" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="info">Info</option>
                            <option value="warning">Warning</option>
                            <option value="error">Error</option>
                            <option value="debug">Debug</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Message</label>
                        <input v-model="newLog.message" type="text" placeholder="Enter log message..." 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="md:col-span-4">
                        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-md flex items-center">
                            <i class="fas fa-plus mr-2"></i>
                            Add Log
                        </button>
                    </div>
                </form>
            </div>

            <!-- Logs Table -->
            <div class="bg-white rounded-lg shadow-md">
                <div class="px-6 py-4 border-b border-gray-200">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-semibold text-gray-900">Recent Logs</h2>
                        <div class="flex items-center space-x-4">
                            <select v-model="selectedRegion" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">All Regions</option>
                                <option value="us-east-1">US East</option>
                                <option value="us-west-2">US West</option>
                                <option value="eu-west-1">EU West</option>
                            </select>
                            <select v-model="logLimit" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="10">10 logs</option>
                                <option value="25">25 logs</option>
                                <option value="50">50 logs</option>
                                <option value="100">100 logs</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Timestamp</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Region</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Level</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Message</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr v-for="log in filteredLogs" :key="log.id" class="log-entry hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                    {{ formatTime(log.timestamp) }}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                                          :style="`background-color: ${log.color}20; color: ${log.color}`">
                                        {{ log.source_region || log.region }}
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                                          :class="{
                                              'bg-blue-100 text-blue-800': log.level === 'info',
                                              'bg-yellow-100 text-yellow-800': log.level === 'warning',
                                              'bg-red-100 text-red-800': log.level === 'error',
                                              'bg-gray-100 text-gray-800': log.level === 'debug'
                                          }">
                                        {{ log.level.toUpperCase() }}
                                    </span>
                                </td>
                                <td class="px-6 py-4 text-sm text-gray-900">
                                    {{ log.message }}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                    {{ log.id.substring(0, 8) }}...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div v-if="filteredLogs.length === 0" class="px-6 py-8 text-center text-gray-500">
                    <i class="fas fa-inbox text-4xl mb-4"></i>
                    <p>No logs found</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        const { createApp } = Vue

        createApp({
            data() {
                return {
                    regions: [],
                    logs: [],
                    selectedRegion: '',
                    logLimit: 25,
                    lastUpdate: 'Never',
                    newLog: {
                        region: 'us-east-1',
                        level: 'info',
                        message: ''
                    },
                    refreshInterval: null
                }
            },
            computed: {
                filteredLogs() {
                    let filtered = this.logs
                    if (this.selectedRegion) {
                        filtered = filtered.filter(log => 
                            (log.source_region || log.region) === this.selectedRegion
                        )
                    }
                    return filtered.slice(0, parseInt(this.logLimit))
                }
            },
            methods: {
                async refreshData() {
                    try {
                        // Refresh status
                        const statusResponse = await fetch('/api/status')
                        this.regions = await statusResponse.json()
                        
                        // Refresh logs
                        const logsResponse = await fetch(`/api/logs?limit=${this.logLimit}`)
                        const logsData = await logsResponse.json()
                        this.logs = logsData.logs
                        
                        this.lastUpdate = new Date().toLocaleTimeString()
                    } catch (error) {
                        console.error('Failed to refresh data:', error)
                    }
                },
                async addLog() {
                    if (!this.newLog.message.trim()) {
                        alert('Please enter a message')
                        return
                    }
                    
                    try {
                        const response = await fetch('/api/logs', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(this.newLog)
                        })
                        
                        const result = await response.json()
                        if (result.status === 'success') {
                            // Reset form
                            this.newLog.message = ''
                            // Refresh data
                            await this.refreshData()
                        } else {
                            alert('Failed to add log: ' + result.message)
                        }
                    } catch (error) {
                        console.error('Failed to add log:', error)
                        alert('Failed to add log')
                    }
                },
                formatTime(timestamp) {
                    if (!timestamp) return 'N/A'
                    return new Date(timestamp).toLocaleString()
                },
                startAutoRefresh() {
                    this.refreshInterval = setInterval(() => {
                        this.refreshData()
                    }, 5000) // Refresh every 5 seconds
                },
                stopAutoRefresh() {
                    if (this.refreshInterval) {
                        clearInterval(this.refreshInterval)
                        this.refreshInterval = null
                    }
                }
            },
            mounted() {
                this.refreshData()
                this.startAutoRefresh()
            },
            beforeUnmount() {
                this.stopAutoRefresh()
            }
        }).mount('#app')
    </script>
</body>
</html> 